
volumes:
  download:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${DOWNLOAD_PATH}
    name: ${TANGO_APP_NAME}_download
  vault:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${VAULT_PATH}
    name: ${TANGO_APP_NAME}_vault
  web_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${WEB_PATH}
    name: ${TANGO_APP_NAME}_web_data
  newsletters_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${TAUTULLI_NEWSLETTERS_PATH}
    name: ${TANGO_APP_NAME}_newsletters_data
  organizr2_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${ORGANIZR2_DATA_PATH}
    name: ${TANGO_APP_NAME}_organizr2_data
  o3_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${O3_DATA_PATH}
    name: ${TANGO_APP_NAME}_o3_data
  plex_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PLEX_DATA_PATH}
    name: ${TANGO_APP_NAME}_plex_data
  mkvtoolnix_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${MKVTOOLNIX_DATA_PATH}
    name: ${TANGO_APP_NAME}_mkvtoolnix_data
  jdownloader2_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${JDOWNLOADER2_DATA_PATH}
    name: ${TANGO_APP_NAME}_jdownloader2_data
  jdownloader2_download:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${JDOWNLOADER2_DOWNLOAD_PATH}
    name: ${TANGO_APP_NAME}_jdownloader2_download
  transmission_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${TRANSMISSION_DATA_PATH}
    name: ${TANGO_APP_NAME}_transmission_data
  transmission_download:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${TRANSMISSION_DOWNLOAD_PATH}
    name: ${TANGO_APP_NAME}_transmission_download
  transmission_watch:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${VAULT_TORRENT_PATH}
    name: ${TANGO_APP_NAME}_transmission_watch
  nzbtomedia_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${NZBTOMEDIA_DATA_PATH}
    name: ${TANGO_APP_NAME}_nzbtomedia_data
  booksonic_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${BOOKSONIC_DATA_PATH}
    name: ${TANGO_APP_NAME}_booksonic_data
  calibreweb_books_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${CALIBREWEB_BOOKS_DATA_PATH}
    name: ${TANGO_APP_NAME}_calibreweb_books_data
  calibreweb_books_media:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${CALIBREWEB_BOOKS_MEDIA_PATH}
    name: ${TANGO_APP_NAME}_calibreweb_books_media
  # calibreweb_comics_data:
  #   driver: local
  #   driver_opts:
  #     type: none
  #     o: bind
  #     device: ${APP_DATA_PATH}/calibreweb_comics
  # calibreweb_comics_media:
  #   driver: local
  #   driver_opts:
  #     type: none
  #     o: bind
  #     device: ${MAMBO_MEDIA_PATH}/${MAMBO_MEDIA_CALIBREDB_FOLDER}/calibreweb_comics



# NOTE : yaml do not support array merge, so we cannot factorize volume or labels declaration here
# https://forums.docker.com/t/is-there-any-way-to-use-extension-fields-in-docker-compose-with-docker-secrets/68602
# https://github.com/linuxserver/docker-calibre-web
x-calibreweb: &default-calibreweb
  image: linuxserver/calibre-web:${CALIBREWEB_VERSION:-latest}
  depends_on: 
    - service_init
    #- calibre_mod
  restart: unless-stopped
  environment:
    - PUID=${TANGO_USER_ID:-0}
    - PGID=${TANGO_GROUP_ID:-0}
    # NOTE : you can choose a calibre binary version to inject with CALIBRE_MOD_VERSION or just use a latest version available
    #       a linuxserver.io module must be used from docker hub repository only,
    #       it cannot be used from a local build
    #       https://github.com/StudioEtrange/docker-calibre-mod
    #       https://hub.docker.com/repository/docker/studioetrange/calibre-mod
    - DOCKER_MODS=studioetrange/calibre-mod:${CALIBRE_MOD_VERSION:-latest}
  networks:
    - default
  expose:
    - 8083
  build:
    context: https://github.com/linuxserver/docker-calibre-web.git
    args:
      - CALIBREWEB_RELEASE=${CALIBREWEB_VERSION}



services:

  # NOTE : service_init will be merged with service_init from tango compose file
  service_init:
    volumes:
      - download:/download

  # Main mambo portal
  # https://github.com/Organizr/docker-organizr
  organizr2:
    image: organizr/organizr
    container_name: ${TANGO_APP_NAME}_organizr2
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      # will contain organizr2 configuration
      - organizr2_data:/config
    environment:
      - PUID=${TANGO_USER_ID:-0}
      - PGID=${TANGO_GROUP_ID:-0}
      # use 'manual' as branch value to disable code update installed into /config folder
      - branch=${ORGANIZR2_VERSION:-v2-master}
      - fpm=true
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.organizr2.loadbalancer.server.port=80"
      - "traefik.http.services.organizr2.loadbalancer.server.scheme=http"
      - "traefik.http.services.organizr2.loadbalancer.passhostheader=true"
      # generic middleware
      # force request to return X-Frame-Options: allow-from * - can be used to force service to show into an organizr iframe even if they do not allow it
      - 'traefik.http.middlewares.xframe-allow-all.headers.customFrameOptionsValue=allow-from *'
      # routers
      - "traefik.http.routers.organizr2.entrypoints=${ORGANIZR2_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.organizr2.rule=HostRegexp(`{subdomain:${ORGANIZR2_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"      
      - "traefik.http.routers.organizr2.service=organizr2"
      - "traefik.http.routers.organizr2.priority=${ORGANIZR2_PRIORITY}"
      - "traefik.http.routers.organizr2-secure.entrypoints=${ORGANIZR2_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.organizr2-secure.rule=HostRegexp(`{subdomain:${ORGANIZR2_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"      
      - "traefik.http.routers.organizr2-secure.priority=${ORGANIZR2_PRIORITY}"
      - "traefik.http.routers.organizr2-secure.service=organizr2"
      - "traefik.http.routers.organizr2-secure.tls=true"
      - "traefik.http.routers.organizr2-secure.tls.domains[0].main=${ORGANIZR2_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.organizr2.middlewares=error-middleware"
      - "traefik.http.routers.organizr2-secure.middlewares=error-middleware"
    networks:
      - default
    expose:
      - 80
  o3:
    image: organizr/organizr
    container_name: ${TANGO_APP_NAME}_o3
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      # will contain organizr2 configuration
      - o3_data:/config
    environment:
      - PUID=${TANGO_USER_ID:-0}
      - PGID=${TANGO_GROUP_ID:-0}
      # use 'manual' as branch value to disable code update installed into /config folder
      - branch=${O3_VERSION:-v2-master}
      - fpm=true
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.o3.loadbalancer.server.port=80"
      - "traefik.http.services.o3.loadbalancer.server.scheme=http"
      - "traefik.http.services.o3.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.o3.entrypoints=${O3_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.o3.rule=HostRegexp(`{subdomain:${O3_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"      
      - "traefik.http.routers.o3.service=o3"
      - "traefik.http.routers.o3.priority=${O3_PRIORITY}"
      - "traefik.http.routers.o3-secure.entrypoints=${O3_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.o3-secure.rule=HostRegexp(`{subdomain:${O3_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"      
      - "traefik.http.routers.o3-secure.priority=${O3_PRIORITY}"
      - "traefik.http.routers.o3-secure.service=o3"
      - "traefik.http.routers.o3-secure.tls=true"
      - "traefik.http.routers.o3-secure.tls.domains[0].main=${O3_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.o3.middlewares=error-middleware"
      - "traefik.http.routers.o3-secure.middlewares=error-middleware"
    networks:
      - default
    expose:
      - 80

  # Plex statistics and management tools
  tautulli:
    image: studioetrange/docker-tautulli:${TAUTULLI_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_tautulli
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      # data/tautulli will contain tautulli configuration
      - data:/data
      # newsletters_data will be used for generated newsletter
      - newsletters_data:/data/tautulli/newsletters
    environment:
      - SERVICE_USER=${TANGO_USER_ID:-0}:${TANGO_GROUP_ID:-0}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.tautulli.loadbalancer.server.port=8181"
      - "traefik.http.services.tautulli.loadbalancer.server.scheme=http"
      - "traefik.http.services.tautulli.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.tautulli.entrypoints=${TAUTULLI_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.tautulli.rule=HostRegexp(`{subdomain:${TAUTULLI_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.tautulli.priority=${TAUTULLI_PRIORITY}"
      - "traefik.http.routers.tautulli.service=tautulli"
      - "traefik.http.routers.tautulli-secure.entrypoints=${TAUTULLI_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.tautulli-secure.rule=HostRegexp(`{subdomain:${TAUTULLI_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.tautulli-secure.priority=${TAUTULLI_PRIORITY}"
      - "traefik.http.routers.tautulli-secure.service=tautulli"
      - "traefik.http.routers.tautulli-secure.tls=true"
      - "traefik.http.routers.tautulli-secure.tls.domains[0].main=${TAUTULLI_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.tautulli.middlewares=tautulli-auth@rest,error-middleware"
      - "traefik.http.routers.tautulli-secure.middlewares=tautulli-auth@rest,error-middleware"
    networks:
      - default
    expose:
      - 8181
    build:
      context: https://github.com/StudioEtrange/docker-tautulli.git#:ver/${TAUTULLI_VERSION:-latest}

  
  
  # Manage movie/tv show requests
  ombi:
    image: studioetrange/docker-ombi:${OMBI_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_ombi
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      # data/ombi will contain ombi configuration
      - data:/data
    environment:
      - SERVICE_USER=${TANGO_USER_ID:-0}:${TANGO_GROUP_ID:-0}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.ombi.loadbalancer.server.port=5000"
      - "traefik.http.services.ombi.loadbalancer.server.scheme=http"
      - "traefik.http.services.ombi.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.ombi.entrypoints=${OMBI_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.ombi.rule=HostRegexp(`{subdomain:${OMBI_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.ombi.priority=${OMBI_PRIORITY}" 
      - "traefik.http.routers.ombi.service=ombi"
      - "traefik.http.routers.ombi-secure.entrypoints=${OMBI_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.ombi-secure.rule=HostRegexp(`{subdomain:${OMBI_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.ombi-secure.priority=${OMBI_PRIORITY}"  
      - "traefik.http.routers.ombi-secure.service=ombi"
      - "traefik.http.routers.ombi-secure.tls=true"
      - "traefik.http.routers.ombi-secure.tls.domains[0].main=${OMBI_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.ombi.middlewares=ombi-auth@rest,error-middleware"
      - "traefik.http.routers.ombi-secure.middlewares=ombi-auth@rest,error-middleware"
    networks:
      - default
    expose:
      - 5000
    build:
      context: https://github.com/StudioEtrange/docker-ombi.git#:ver/${OMBI_VERSION:-latest}


  # Newzgroup downloader
  sabnzbd:
    image: studioetrange/docker-sabnzbd:${SABNZBD_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_sabnzbd
    depends_on:
      - service_init
    restart: unless-stopped
    volumes:
      # data/sabnzbd will contain sabnzbd configuration
      - data:/data
      # different paths used by sabnzbd
      - download:/download
      - vault:/vault
      - artefact:${TANGO_ARTEFACT_MOUNT_POINT:-/artefact}
    environment:
      - SERVICE_USER=${TANGO_USER_ID:-0}:${TANGO_GROUP_ID:-0}
      - 'HOST_WHITELIST_ENTRIES=sabnzbd,${SABNZBD_SUBDOMAIN}${TANGO_DOMAIN},${TANGO_HOSTNAME},${TANGO_HOSTNAME}.${TANGO_DOMAIN},${SABNZBD_ADDITIONAL_DOMAIN}'
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.sabnzbd.loadbalancer.server.port=8080"
      - "traefik.http.services.sabnzbd.loadbalancer.server.scheme=http"
      - "traefik.http.services.sabnzbd.loadbalancer.passhostheader=true"
      # middleware
      - "traefik.http.middlewares.sabnzbd-stripprefix.stripprefix.prefixes=/sabnzbd, /sabnzbd/"
      # routers
      - "traefik.http.routers.sabnzbd.entrypoints=${SABNZBD_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.sabnzbd.rule=HostRegexp(`{subdomain:${SABNZBD_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) || HostRegexp(`{domain:${TANGO_DOMAIN:-.*}}`) && PathPrefix(`/sabnzbd`)"
      - "traefik.http.routers.sabnzbd.priority=${SABNZBD_PRIORITY}"
      - "traefik.http.routers.sabnzbd.service=sabnzbd"
      - "traefik.http.routers.sabnzbd-secure.entrypoints=${SABNZBD_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.sabnzbd-secure.rule=HostRegexp(`{subdomain:${SABNZBD_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) || HostRegexp(`{domain:${TANGO_DOMAIN:-.*}}`) && PathPrefix(`/sabnzbd`)"
      - "traefik.http.routers.sabnzbd-secure.priority=${SABNZBD_PRIORITY}"
      - "traefik.http.routers.sabnzbd-secure.service=sabnzbd"
      - "traefik.http.routers.sabnzbd-secure.tls=true"
      - "traefik.http.routers.sabnzbd-secure.tls.domains[0].main=${SABNZBD_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.sabnzbd.middlewares=sabnzbd-stripprefix,sabnzbd-auth@rest,error-middleware"
      - "traefik.http.routers.sabnzbd-secure.middlewares=sabnzbd-stripprefix,sabnzbd-auth@rest,error-middleware"
    networks:
      - default
    expose:
      - 8080
      # HTTPS port
      - 8081
    build:
      context: https://github.com/StudioEtrange/docker-sabnzbd.git#:ver/${SABNZBD_VERSION:-latest}

  # nzbtomedia : sync nzb software
  # https://github.com/clinton-hall/nzbToMedia
  nzbtomedia:
    image: studioetrange/nzbtomedia:latest
    container_name: ${TANGO_APP_NAME}_nzbtomedia
    depends_on:
      - service_init
    volumes:
      # data/nzbtomedia will contain nzbtomedia
      - nzbtomedia_data:/app
    environment:
      - PUID=${TANGO_USER_ID:-0}
      - PGID=${TANGO_GROUP_ID:-0}
      - VERSION=${NZBTOMEDIA_VERSION:-master}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
    networks:
      - default
    build:
      context: ./pool/image/nzbtomedia


  # Media server
  plex:
    image: plexinc/pms-docker:${PLEX_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_plex
    # add a DNS entry to the existing 'plex' entry only inside this container
    # the default plex server name is defined by the hostname
    hostname: mambo
    depends_on:
      - service_init
    restart: unless-stopped
    volumes:
      # will contain plex configuration
      - plex_data:/config
      - artefact:${TANGO_ARTEFACT_MOUNT_POINT:-/artefact}
      - ${PLEX_TRANSCODE_PATH}:/transcode
    environment:
      - PLEX_UID=${TANGO_USER_ID:-0}
      - PLEX_GID=${TANGO_GROUP_ID:-0}
      - CHANGE_CONFIG_DIR_OWNERSHIP=true
      # if server have already be claimed, PLEX_CLAIM env var is ignored
      - PLEX_CLAIM=${PLEX_CLAIM:-}
      - 'ADVERTISE_IP=http://${TANGO_HOSTNAME}:${PLEX_DIRECT_ACCESS_PORT}/,https://${TANGO_HOSTNAME}:${PLEX_DIRECT_ACCESS_PORT}/,http://plex:${NETWORK_PORT_MAIN}/,https://plex:${NETWORK_PORT_MAIN_SECURE}/,http://plex:${NETWORK_PORT_SECONDARY}/,https://plex:${NETWORK_PORT_SECONDARY_SECURE}/,http://plex.${TANGO_DOMAIN}:${NETWORK_PORT_MAIN}/,https://plex.${TANGO_DOMAIN}:${NETWORK_PORT_MAIN_SECURE}/,http://plex.${TANGO_DOMAIN}:${NETWORK_PORT_SECONDARY}/,https://plex.${TANGO_DOMAIN}:${NETWORK_PORT_SECONDARY_SECURE}/,http://${TANGO_HOSTNAME}.${TANGO_DOMAIN}:${NETWORK_PORT_MAIN}/,https://${TANGO_HOSTNAME}.${TANGO_DOMAIN}:${NETWORK_PORT_MAIN_SECURE}/,http://${TANGO_HOSTNAME}.${TANGO_DOMAIN}:${NETWORK_PORT_SECONDARY}/,https://${TANGO_HOSTNAME}.${TANGO_DOMAIN}:${NETWORK_PORT_SECONDARY_SECURE}/,${PLEX_ADDITIONAL_DOMAIN}'
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.plex.loadbalancer.server.port=32400"
      - "traefik.http.services.plex.loadbalancer.server.scheme=http"
      - "traefik.http.services.plex.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.plex.entrypoints=${PLEX_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.plex.rule=HostRegexp(`{subdomain:${PLEX_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.plex.priority=${PLEX_PRIORITY}"
      - "traefik.http.routers.plex.service=plex"
      - "traefik.http.routers.plex-secure.entrypoints=${PLEX_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.plex-secure.rule=HostRegexp(`{subdomain:${PLEX_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.plex-secure.priority=${PLEX_PRIORITY}"
      - "traefik.http.routers.plex-secure.service=plex"
      - "traefik.http.routers.plex-secure.tls=true"
      - "traefik.http.routers.plex-secure.tls.domains[0].main=${PLEX_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      # NOTE : do not activate error-middleware, if so plex service will cannot ask for authentification
      #- "traefik.http.routers.plex.middlewares=error-middleware"
      #- "traefik.http.routers.plex-secure.middlewares=error-middleware"
    networks:
      - default
    expose:
      - 33400/tcp
      - 32400/tcp
      - 3005/tcp
      - 8324/tcp
      - 32469/tcp
      - 1900/udp
      - 32410/udp
      - 32412/udp
      - 32413/udp
      - 32414/udp

  # Tv show download manager
  medusa:
    image: studioetrange/docker-medusa:${MEDUSA_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_medusa
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      # data/medusa will contain medusa configuration
      - data:/data
      # different paths used by medusa
      - download:/download
      - artefact:${TANGO_ARTEFACT_MOUNT_POINT:-/artefact}
    environment:
      - SERVICE_USER=${TANGO_USER_ID:-0}:${TANGO_GROUP_ID:-0}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.medusa.loadbalancer.server.port=8081"
      - "traefik.http.services.medusa.loadbalancer.server.scheme=http"
      - "traefik.http.services.medusa.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.medusa.entrypoints=${MEDUSA_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.medusa.rule=HostRegexp(`{subdomain:${MEDUSA_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.medusa.priority=${MEDUSA_PRIORITY}"
      - "traefik.http.routers.medusa.service=medusa"
      - "traefik.http.routers.medusa-secure.entrypoints=${MEDUSA_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.medusa-secure.rule=HostRegexp(`{subdomain:${MEDUSA_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.medusa-secure.priority=${MEDUSA_PRIORITY}"
      - "traefik.http.routers.medusa-secure.service=medusa"
      - "traefik.http.routers.medusa-secure.tls=true"
      - "traefik.http.routers.medusa-secure.tls.domains[0].main=${MEDUSA_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.medusa.middlewares=medusa-auth@rest,error-middleware"
      - "traefik.http.routers.medusa-secure.middlewares=medusa-auth@rest,error-middleware"
    networks:
      - default
    expose:
      - 8081
    build:
      context: https://github.com/StudioEtrange/docker-medusa.git#:ver/${MEDUSA_VERSION:-latest}

  # MKVToolNix is a set of tools to create, alter and inspect mkv files.
  # NOTE : VNC port is not open here
  # https://hub.docker.com/r/jlesage/mkvtoolnix
  # https://github.com/jlesage/docker-mkvtoolnix
  mkvtoolnix:
    image: jlesage/mkvtoolnix:${MKVTOOLNIX_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_mkvtoolnix
    depends_on:
      - service_init
    restart: unless-stopped
    volumes:
      # will contain mkvtoolnix configuration
      - mkvtoolnix_data:/config
      # different paths used by mkvtoolnix
      - download:/download
      - artefact:${TANGO_ARTEFACT_MOUNT_POINT:-/artefact}
    environment:
      - USER_ID=${TANGO_USER_ID:-0}
      - GROUP_ID=${TANGO_GROUP_ID:-0}
      - KEEP_APP_RUNNING=1
      - DISPLAY_WIDTH=${MKVTOOLNIX_WIDTH:-1280}
      - DISPLAY_HEIGHT=${MKVTOOLNIX_HEIGHT-:768}
      - SECURE_CONNECTION=0
      - CLEAN_TMP_DIR=1
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.mkvtoolnix.loadbalancer.server.port=5800"
      - "traefik.http.services.mkvtoolnix.loadbalancer.server.scheme=http"
      - "traefik.http.services.mkvtoolnix.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.mkvtoolnix.entrypoints=${MKVTOOLNIX_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.mkvtoolnix.rule=HostRegexp(`{subdomain:${MKVTOOLNIX_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.mkvtoolnix.priority=${MKVTOOLNIX_PRIORITY}"
      - "traefik.http.routers.mkvtoolnix.service=mkvtoolnix"
      - "traefik.http.routers.mkvtoolnix-secure.entrypoints=${MKVTOOLNIX_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.mkvtoolnix-secure.rule=HostRegexp(`{subdomain:${MKVTOOLNIX_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.mkvtoolnix-secure.priority=${MKVTOOLNIX_PRIORITY}"
      - "traefik.http.routers.mkvtoolnix-secure.service=mkvtoolnix"
      - "traefik.http.routers.mkvtoolnix-secure.tls=true"
      - "traefik.http.routers.mkvtoolnix-secure.tls.domains[0].main=${MKVTOOLNIX_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.mkvtoolnix.middlewares=mkvtoolnix-auth@rest,error-middleware"
      - "traefik.http.routers.mkvtoolnix-secure.middlewares=mkvtoolnix-auth@rest,error-middleware"
    networks:
      - default
    expose:
      - 5800/tcp
  


  # https://github.com/linuxserver/docker-transmission
  # NOTE : there is 2 subservices transmission_internal and transmission_external
  #     transmission_internal (http://internal-transmission.domain.com) is protected by organizr auth and will auto login with transmission auth basic --> Use this for portal access
  #               if organizr auth is disabled, this subservices will have auto login disabled
  #     transmission_external (http://transmission.domain.com) is NOT protected by organizr auth and need a basic authentification --> Use this for api access with 3rd tool
  #                                                         tested with chrome "Transmission easy client"
  # NOTE : we can not use an errormiddleware because at first request on /transmission/rpc, server respond a 409 AND a special header and the client must retry, an error middleware will cancel the retry !
  transmission:
    # TODO to change image wait for PRs https://github.com/linuxserver/docker-transmission/pull/140 https://github.com/linuxserver/docker-transmission/pull/141
    #image: linuxserver/transmission:${TRANSMISSION_VERSION:-latest}
    image: studioetrange/transmission:latest
    container_name: ${TANGO_APP_NAME}_transmission
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      - transmission_data:/config
      - transmission_download:/downloads
      - transmission_watch:/watch
    environment:
      - PUID=${TANGO_USER_ID:-0}
      - PGID=${TANGO_GROUP_ID:-0}
      - TRANSMISSION_WEB_HOME=${TRANSMISSION_UI}
      - USER=${TRANSMISSION_USER:-}
      - PASS=${TRANSMISSION_PASSWORD:-}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service transmission
      - "traefik.http.services.transmission.loadbalancer.server.port=9091"
      - "traefik.http.services.transmission.loadbalancer.server.scheme=http"
      - "traefik.http.services.transmission.loadbalancer.passhostheader=true"
      - 'traefik.http.middlewares.transmission-autoauthbasic.headers.customrequestheaders.Authorization=Basic ${TRANSMISSION_AUTH_BASIC}'
      # transmission have a lot of problem with url endpoint and code error 409, we need to add /
      - 'traefik.http.middlewares.transmission-slash1.redirectregex.regex=^(https?://[^/]+/transmission/web)$$'
      - 'traefik.http.middlewares.transmission-slash1.redirectregex.replacement=$${1}/'
      - 'traefik.http.middlewares.transmission-slash2.redirectregex.regex=^(https?://[^/]+/transmission/rpc)$$'
      - 'traefik.http.middlewares.transmission-slash2.redirectregex.replacement=$${1}/'
      # sub service transmission_internal
      - "traefik.http.routers.transmission_internal.entrypoints=${TRANSMISSION_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.transmission_internal.rule=HostRegexp(`{subdomain:internal-${TRANSMISSION_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.transmission_internal.priority=${TRANSMISSION_INTERNAL_PRIORITY}"
      - "traefik.http.routers.transmission_internal.service=transmission"
      - "traefik.http.routers.transmission_internal-secure.entrypoints=${TRANSMISSION_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.transmission_internal-secure.rule=HostRegexp(`{subdomain:internal-${TRANSMISSION_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.transmission_internal-secure.priority=${TRANSMISSION_INTERNAL_PRIORITY}"
      - "traefik.http.routers.transmission_internal-secure.service=transmission"
      - "traefik.http.routers.transmission_internal-secure.tls=true"
      - "traefik.http.routers.transmission_internal-secure.tls.domains[0].main=internal-${TRANSMISSION_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      - "traefik.http.routers.transmission_internal.middlewares=transmission-auth@rest,transmission-slash1,transmission-slash2,transmission-autoauthbasic"
      #- "traefik.http.routers.transmission_internal.middlewares=transmission-auth@rest,transmission-authbasic,error-middleware"
      - "traefik.http.routers.transmission_internal-secure.middlewares=transmission-auth@rest,transmission-slash1,transmission-slash2,transmission-autoauthbasic"
      #- "traefik.http.routers.transmission_internal-secure.middlewares=transmission-auth@rest,transmission-authbasic,error-middleware"
      # sub service transmission_external
      - "traefik.http.routers.transmission_external.entrypoints=${TRANSMISSION_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.transmission_external.rule=HostRegexp(`{subdomain:${TRANSMISSION_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.transmission_external.priority=${TRANSMISSION_EXTERNAL_PRIORITY}"
      - "traefik.http.routers.transmission_external.service=transmission"
      - "traefik.http.routers.transmission_external-secure.entrypoints=${TRANSMISSION_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.transmission_external-secure.rule=HostRegexp(`{subdomain:${TRANSMISSION_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.transmission_external-secure.priority=${TRANSMISSION_EXTERNAL_PRIORITY}"
      - "traefik.http.routers.transmission_external-secure.service=transmission"
      - "traefik.http.routers.transmission_external-secure.tls=true"
      - "traefik.http.routers.transmission_external-secure.tls.domains[0].main=${TRANSMISSION_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      - "traefik.http.routers.transmission_external.middlewares=transmission-slash1,transmission-slash2"
      - "traefik.http.routers.transmission_external-secure.middlewares=transmission-slash1,transmission-slash2"
    networks:
       - default
    expose:
      - 51413/tcp
      - 51413/udp
    ports:
      - ${TRANSMISSION_PORT}:51413/tcp
      - ${TRANSMISSION_PORT}:51413/udp
    build:
      context: https://github.com/StudioEtrange/docker-transmission.git#mambo





  # https://github.com/jlesage/docker-makemkv
  # # NOTE : VNC not open
  # makemkv:
  #   image: jlesage/makemkv:${MAKEMKV_VERSION:-latest}
  #   container_name: ${TANGO_APP_NAME}_makemkv
  #   depends_on:
  #     - service_init
  #   restart: unless-stopped
  #   volumes:
  #     # will contain makemkv configuration
  #     - makemkv_data:/config
  #     # different paths used by makemkv
  #     - download:/download
  #     - artefact:${TANGO_ARTEFACT_MOUNT_POINT:-/artefact}
  #     - /dev/shm:/dev/shm
  #   environment:
  #     - USER_ID=${TANGO_USER_ID:-0}
  #     - GROUP_ID=${TANGO_GROUP_ID:-0}
  #     - KEEP_APP_RUNNING=1
  #     - DISPLAY_WIDTH=${MAKEMKV_WIDTH:-1280}
  #     - DISPLAY_HEIGHT=${MAKEMKV_HEIGHT-:768}
  #     - SECURE_CONNECTION=0
  #     - CLEAN_TMP_DIR=1
  #   labels:
  #     - "${TANGO_INSTANCE_NAME}.managed=true"
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.makemkv.entrypoints=${MAKEMKV_ENTRYPOINTS:-web_main}"
  #     - "traefik.http.routers.makemkv.rule=HostRegexp(`{subdomain:${MAKEMKV_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
  #     - "traefik.http.routers.makemkv.priority=${MAKEMKV_PRIORITY}"
  #     - "traefik.http.routers.makemkv.service=makemkv"
  #     - "traefik.http.routers.makemkv-secure.entrypoints=${MAKEMKV_ENTRYPOINTS_SECURE:-web_main_secure}"
  #     - "traefik.http.routers.makemkv-secure.rule=HostRegexp(`{subdomain:${MAKEMKV_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
  #     - "traefik.http.routers.makemkv-secure.priority=${MAKEMKV_PRIORITY}"
  #     - "traefik.http.routers.makemkv-secure.service=makemkv"
  #     - "traefik.http.routers.makemkv-secure.tls=true"
  #     - "traefik.http.routers.makemkv-secure.tls.domains[0].main=${MAKEMKV_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
  #     - "traefik.http.services.makemkv.loadbalancer.server.port=5800"
  #     - "traefik.http.services.makemkv.loadbalancer.server.scheme=http"
  #     - "traefik.http.services.makemkv.loadbalancer.passhostheader=true"
  #     - "traefik.http.routers.makemkv.middlewares=makemkv-auth@rest,error-middleware"
  #     - "traefik.http.routers.makemkv-secure.middlewares=makemkv-auth@rest,error-middleware"
  #   networks:
  #     - default
  #   expose:
  #     - 5800/tcp

  # web area
  web:
    image: httpd:${WEB_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_web
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      - web_data:/usr/local/apache2/htdocs
      - newsletters_data:/usr/local/apache2/htdocs/newsletter
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service : web
      - "traefik.http.services.web.loadbalancer.server.port=80"
      - "traefik.http.services.web.loadbalancer.server.scheme=http"
      - "traefik.http.services.web.loadbalancer.passhostheader=true"
      # sub service web_site
      - "traefik.http.routers.web_site.entrypoints=${WEB_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.web_site.rule=HostRegexp(`{subdomain:${WEB_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.web_site.priority=${WEB_SITE_PRIORITY}"
      - "traefik.http.routers.web_site.service=web"
      - "traefik.http.routers.web_site-secure.entrypoints=${WEB_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.web_site-secure.rule=HostRegexp(`{subdomain:${WEB_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.web_site-secure.priority=${WEB_SITE_PRIORITY}"
      - "traefik.http.routers.web_site-secure.service=web"
      - "traefik.http.routers.web_site-secure.tls=true"
      - "traefik.http.routers.web_site-secure.tls.domains[0].main=${WEB_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      - "traefik.http.routers.web_site.middlewares=error-middleware"
      - "traefik.http.routers.web_site-secure.middlewares=error-middleware"
      # sub service web_newsletter
      - "traefik.http.routers.web_newsletter.entrypoints=${WEB_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.web_newsletter.rule=HostRegexp(`{subdomain:${WEB_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) && (PathPrefix(`/image`) || PathPrefix(`/newsletter`))"
      - "traefik.http.routers.web_newsletter.priority=${WEB_NEWSLETTER_PRIORITY}"
      - "traefik.http.routers.web_newsletter.service=tautulli"
      - "traefik.http.routers.web_newsletter-secure.entrypoints=${WEB_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.web_newsletter-secure.rule=HostRegexp(`{subdomain:${WEB_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) && (PathPrefix(`/image`) || PathPrefix(`/newsletter`))"
      - "traefik.http.routers.web_newsletter-secure.priority=${WEB_NEWSLETTER_PRIORITY}"
      - "traefik.http.routers.web_newsletter-secure.service=tautulli"
      - "traefik.http.routers.web_newsletter-secure.tls=true"
      - "traefik.http.routers.web_newsletter-secure.tls.domains[0].main=${WEB_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      - "traefik.http.routers.web_newsletter.middlewares=error-middleware"
      - "traefik.http.routers.web_newsletter-secure.middlewares=error-middleware"
    networks:
      - default
    expose:
      - 80

   
  # Audiobook and podcast streamer
  # https://booksonic.org/
  # https://github.com/popeen/Booksonic-Air
  # https://hub.docker.com/r/linuxserver/booksonic-air
  # https://github.com/linuxserver/docker-booksonic-air
  booksonic:
    image: linuxserver/booksonic-air:${BOOKSONIC_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_booksonic
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      - booksonic_data:/config
    environment:
      - PUID=${TANGO_USER_ID:-0}
      - PGID=${TANGO_GROUP_ID:-0}
      - CONTEXT_PATH=/
      # FIX https/http mixed content error into web browser
      # https://github.com/popeen/Booksonic-Air/issues/23
      - "JAVA_OPTS=-Dserver.use-forward-headers=true"
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.booksonic.loadbalancer.server.port=4040"
      - "traefik.http.services.booksonic.loadbalancer.server.scheme=http"
      - "traefik.http.services.booksonic.loadbalancer.passhostheader=true"
      # routers
      - "traefik.http.routers.booksonic.entrypoints=${BOOKSONIC_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.booksonic.rule=HostRegexp(`{subdomain:${BOOKSONIC_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.booksonic.priority=${BOOKSONIC_PRIORITY}"
      - "traefik.http.routers.booksonic.service=booksonic"
      - "traefik.http.routers.booksonic-secure.entrypoints=${BOOKSONIC_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.booksonic-secure.rule=HostRegexp(`{subdomain:${BOOKSONIC_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`)"
      - "traefik.http.routers.booksonic-secure.priority=${BOOKSONIC_PRIORITY}"
      - "traefik.http.routers.booksonic-secure.service=booksonic"
      - "traefik.http.routers.booksonic-secure.tls=true"
      - "traefik.http.routers.booksonic-secure.tls.domains[0].main=${BOOKSONIC_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      - "traefik.http.routers.booksonic.middlewares=booksonic-auth@rest,error-middleware"
      - "traefik.http.routers.booksonic-secure.middlewares=booksonic-auth@rest,error-middleware"
      # airsonic (and booksonic) cannot be correctly print into an iframe
      #     https://github.com/airsonic/airsonic/issues/583
      #     airsonic fix an X-Frame-Options to SAMEORIGIN to not allow be print into an iframe
      #     we can override this with a middleware
      # - 'traefik.http.middlewares.booksonic-iframe.headers.customFrameOptionsValue=allow-from *'
      #     but it do not really work well
    networks:
      - default
    expose:
      - 4040/tcp
  
  # direct download manager
  # https://github.com/PlusMinus0/headless-jd2-docker
  jdownloader2:
    image: plusminus/jdownloader2-headless:${JDOWNLOADER2_VERSION:-latest}
    container_name: ${TANGO_APP_NAME}_jdownloader2
    depends_on: 
      - service_init
    restart: unless-stopped
    volumes:
      - jdownloader2_download:/opt/JDownloader/Downloads
      - jdownloader2_data:/opt/JDownloader/cfg
    environment:
      - UID=${TANGO_USER_ID:-0}
      - GID=${TANGO_GROUP_ID:-0}
      - EMAIL=${JDOWNLOADER2_EMAIL:-}
      - PASSWORD=${JDOWNLOADER2_PASSWORD:-}
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=false"
    networks:
      - default
   




# TODO ?
# do we need to do this at first run init :  https://github.com/cgspeck/docker-rdp-calibre/blob/master/firstrun.sh


# TODO ?
# # taken from https://github.com/Thraxis/docker-lazylibrarian-calibre/blob/22db28939571b6a1b3416e3774b7c93807175976/Dockerfile#L10
# ENV CALIBRE_CONFIG_DIRECTORY="/config/calibre/"
# ENV CALIBRE_TEMP_DIR="/config/calibre/tmp/"
# ENV CALIBRE_CACHE_DIRECTORY="/config/cache/calibre/"

  calibreweb_books:
    << : *default-calibreweb
    container_name: ${TANGO_APP_NAME}_calibreweb_books
    volumes:
      # will contain calibre-web configuration
      - calibreweb_books_data:/config
      # different paths used by calibreweb
      - calibreweb_books_media:/books
    labels:
      - "${TANGO_INSTANCE_NAME}.managed=true"
      - "traefik.enable=true"
      # service
      - "traefik.http.services.calibreweb_books.loadbalancer.server.port=8083"
      - "traefik.http.services.calibreweb_books.loadbalancer.server.scheme=http"
      - "traefik.http.services.calibreweb_books.loadbalancer.passhostheader=true"
      # middleware
      - "traefik.http.middlewares.calibreweb_books-stripprefix.stripprefix.prefixes=/${CALIBREWEB_BOOKS_SUBPATH}, /${CALIBREWEB_BOOKS_SUBPATH}/"
      # routers
      - "traefik.http.routers.calibreweb_books.entrypoints=${CALIBREWEB_BOOKS_ENTRYPOINTS:-web_main}"
      - "traefik.http.routers.calibreweb_books.rule=HostRegexp(`{subdomain:${CALIBREWEB_BOOKS_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) || HostRegexp(`{domain:${TANGO_DOMAIN:-.*}}`) && PathPrefix(`/${CALIBREWEB_BOOKS_SUBPATH}`)"
      - "traefik.http.routers.calibreweb_books.priority=${CALIBREWEB_BOOKS_PRIORITY}"
      - "traefik.http.routers.calibreweb_books.service=calibreweb_books"
      - "traefik.http.routers.calibreweb_books-secure.entrypoints=${CALIBREWEB_BOOKS_ENTRYPOINTS_SECURE:-web_main_secure}"
      - "traefik.http.routers.calibreweb_books-secure.rule=HostRegexp(`{subdomain:${CALIBREWEB_BOOKS_SUBDOMAIN}}{domain:${TANGO_DOMAIN:-.*}}`) || HostRegexp(`{domain:${TANGO_DOMAIN:-.*}}`) && PathPrefix(`/${CALIBREWEB_BOOKS_SUBPATH}`)"
      - "traefik.http.routers.calibreweb_books-secure.priority=${CALIBREWEB_BOOKS_PRIORITY}"
      - "traefik.http.routers.calibreweb_books-secure.service=calibreweb_books"
      - "traefik.http.routers.calibreweb_books-secure.tls=true"
      - "traefik.http.routers.calibreweb_books-secure.tls.domains[0].main=${CALIBREWEB_BOOKS_SUBDOMAIN}${TANGO_DOMAIN:-.*}"
      # routers middleware
      - "traefik.http.routers.calibreweb_books.middlewares=calibreweb_books-auth@rest,xframe-allow-all,error-middleware"
      - "traefik.http.routers.calibreweb_books-secure.middlewares=calibreweb_books-auth@rest,xframe-allow-all,error-middleware"
      #- "traefik.http.routers.calibreweb_books.middlewares=calibreweb_books-stripprefix,calibreweb_books-auth@rest,xframe-allow-all,error-middleware"
      #- "traefik.http.routers.calibreweb_books-secure.middlewares=calibreweb_books-stripprefix,calibreweb_books-auth@rest,xframe-allow-all,error-middleware"
  
  # calibreweb_comics:
  #   << : *default-calibreweb
  #   container_name: ${TANGO_APP_NAME}_calibreweb_comics
  #   volumes:
  #     # will contain calibre-web configuration
  #     - calibreweb_comics_data:/config
  #     # different paths used by calibreweb
  #     - calibreweb_comics_media:/books
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.calibreweb_comics.entrypoints=web_secondary"
  #     - "traefik.http.routers.calibreweb_comics.rule=HostRegexp(`{subdomain:calibreweb_comics}.{domain:${TANGO_DOMAIN:-.*}}`) || HostRegexp(`{domain:${TANGO_DOMAIN:-.*}}`) && PathPrefix(`/calibreweb_comics`)"
  #     - "traefik.http.routers.calibreweb_comics.service=calibreweb_comics"
  #     - "traefik.http.services.calibreweb_comics.loadbalancer.server.port=8083"
  #     - "traefik.http.services.calibreweb_comics.loadbalancer.server.scheme=http"
  #     - "traefik.http.services.calibreweb_comics.loadbalancer.passhostheader=true"
  #     - "traefik.http.routers.calibreweb_comics.middlewares=calibreweb_comics-stripprefix"
  #     - "traefik.http.middlewares.calibreweb_comics-stripprefix.stripprefix.prefixes=/calibreweb_comics, /calibreweb_comics/"
